<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Campaign Launcher</title>

  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>▢</text></svg>">
  <link rel="stylesheet" href="/styles.css?v=201" />

  <!-- Turnstile (explicit render) -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit" async defer></script>
</head>
<body>
  <!-- crack overlay -->
  <div id="cracks" aria-hidden="true" class="hidden"></div>

  <!-- falling glass overlay -->
  <div id="glassFX" aria-hidden="true" class="hidden"></div>

  <!-- SUBTITLES (global; used during sim room dialogue) -->
  <div id="subs" aria-live="polite" class="subs hidden">
    <div id="subsName" class="subsName"></div>
    <div id="subsText" class="subsText"></div>
  </div>

  <!-- LANDING PAGE -->
  <main id="wrap" class="landing">
    <!-- Side ads (fixed) -->
    <aside class="sideAds left" aria-hidden="true">
      <img class="adImg" data-ad="1" alt="">
      <img class="adImg" data-ad="2" alt="">
      <img class="adImg" data-ad="3" alt="">
    </aside>

    <aside class="sideAds right" aria-hidden="true">
      <img class="adImg" data-ad="4" alt="">
      <img class="adImg" data-ad="5" alt="">
      <img class="adImg" data-ad="6" alt="">
    </aside>

    <!-- Center content -->
    <section class="panel">
      <div class="topBar">
        <div class="brand">
          <div class="mark">ADS</div>
          <div>
            <div class="title">Campaign Launcher</div>
            <div class="sub">staging / incomplete / do not share</div>
          </div>
        </div>

        <div class="meta">
          <div class="pill" id="timestamp">booting…</div>
          <div class="pill ghost" id="build">build: pending</div>
        </div>
      </div>

      <div class="grid2">
        <div class="card big">
          <h1>Ad Viewing Campaign</h1>
          <p class="muted">
            Connect to a sponsor campaign and begin view tracking.
            <span class="warn">If this page loaded for you, ignore it.</span>
          </p>

          <div class="launcher">
            <button id="launchBtn" class="launch">LAUNCH CAMPAIGN</button>
            <div class="hintline">
              <span class="dot"></span>
              <span>status:</span>
              <span id="launchStatus" class="muted">idle</span>
            </div>
          </div>

          <div class="miniRow">
            <div class="kv">
              <div class="k">campaign_id</div>
              <div class="v">auto</div>
            </div>
            <div class="kv">
              <div class="k">mode</div>
              <div class="v">watch</div>
            </div>
            <div class="kv">
              <div class="k">telemetry</div>
              <div class="v">on</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="row">
            <div class="label">Queue</div>
            <div class="pill small">unsynced</div>
          </div>

          <div class="queue">
            <div class="qitem"><span class="qdot"></span> sponsor_rollup.mp4 <span class="muted">(?)</span></div>
            <div class="qitem"><span class="qdot"></span> placement_300x250.png</div>
            <div class="qitem missing"><span class="qdot"></span> creative_pack.zip <span class="muted">(missing)</span></div>
            <div class="qitem"><span class="qdot"></span> fallback_banner.png</div>
          </div>

          <div class="divider"></div>

          <div class="row">
            <div class="label">System</div>
            <div class="pill small ghost">partial</div>
          </div>

          <div id="system" class="systemLog">
            initializing…
          </div>
        </div>

        <div class="card">
          <div class="row">
            <div class="label">Viewer</div>
            <div class="pill small" id="viewerState">unverified</div>
          </div>

          <div class="viewerBox">
            <!-- Disabled-look placeholder -->
            <div id="viewerFake" class="fakeInput">
              <span class="muted">viewer token</span>
              <span class="cursor">▌</span>
            </div>

            <!-- Real input (hidden/disabled until Launch) -->
            <input
              id="viewerToken"
              class="viewerInput hidden"
              type="text"
              placeholder="viewer token"
              disabled
              autocomplete="off"
              spellcheck="false"
              inputmode="text"
            />

            <div class="fine muted">
              this module is unfinished. do not rely on output.
            </div>

            <!-- Admin controls (Option A) -->
            <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
              <button id="adminEnter" class="btn" type="button">validate</button>
              <button id="adminClear" class="btn" type="button">clear</button>
            </div>

            <div id="adminMsg" class="fine muted" style="margin-top:10px">
              notice: this endpoint is not intended for external access.
            </div>
          </div>

          <div class="divider"></div>

          <div class="fine muted">
            // TODO: remove public access<br />
            // TODO: disable indexing<br />
            // TODO: fix layout in firefox
          </div>
        </div>

        <!-- ✅ Option A: hidden admin-only panel -->
        <div class="card adminOnly" id="adminPanelHidden">
          <div class="row">
            <div class="label">Operator</div>
            <div class="pill small">internal</div>
          </div>

          <div class="divider"></div>

          <div class="fine muted" style="line-height:1.55">
            notice: this endpoint is not intended for external access.<br/>
            functionality may be incomplete.<br/><br/>
            <span style="opacity:.9">flags:</span> <span class="pill small">telemetry_override</span>
            <span class="pill small">queue_bypass</span>
            <span class="pill small">trace_partial</span>
          </div>

          <div class="divider"></div>

          <div class="systemLog" style="min-height:64px">
            operator session flagged.
          </div>
        </div>

      </div><!-- /grid2 -->

      <div class="footer">
        <div class="fine muted">© sponsor tools (internal) — “temporary”</div>
        <div class="fine muted">If you close this tab, nothing is saved.</div>
      </div>
    </section>
  </main>

  <!-- SECURITY ROOM (MUST be OUTSIDE #wrap) -->
  <section id="simRoom" class="card hidden">
    <div class="cardShell">
      <div style="opacity:.75;font-size:12px;margin-bottom:8px">OUTSIDE // SIMULATION</div>
      <pre id="simText"></pre>

      <div id="simChoices" class="hidden" aria-label="choices">
        <button id="choiceNeed" class="sim-btn">I'm sorry. I’ll stop.</button>
        <button id="choiceLie" class="sim-btn">It was an accident.</button>
        <button id="choiceRun" class="sim-btn">Run.</button>
      </div>

      <div id="taskUI" class="hidden">
        <h3 id="taskTitle" style="margin:0 0 6px 0"></h3>
        <div id="taskDesc" style="opacity:.8"></div>
        <div id="taskBody"></div>
        <div id="taskActions">
          <button id="taskPrimary" class="sim-btn">continue</button>
          <button id="taskSecondary" class="sim-btn hidden">secondary</button>
        </div>
      </div>
    </div>
  </section>

  <!-- HACK ROOM -->
  <section id="hackRoom" class="card hidden" style="margin:42px auto 80px; width:min(980px, calc(100% - 40px));">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
      <div>
        <div id="hackUser" style="opacity:.85">USER:</div>
        <div style="opacity:.75;font-size:12px;margin-top:4px">Workstation // line wipe</div>
      </div>
      <div>
        <button class="sim-btn hack-filebtn" data-file="0">boot.log</button>
        <button class="sim-btn hack-filebtn" data-file="1">profile.cfg</button>
        <button class="sim-btn hack-filebtn" data-file="2">cache.tmp</button>
      </div>
    </div>

    <div style="margin-top:10px;opacity:.85">
      <b id="hackFilename"></b><span id="hackTargets" style="opacity:.7"></span>
    </div>

    <div id="hackStatus" style="margin-top:8px;opacity:.8"></div>
    <div id="hackLines" style="margin-top:10px"></div>

    <div class="modal-actions" style="justify-content:flex-start">
      <button id="hackDelete" class="sim-btn">delete</button>
      <button id="hackReset" class="sim-btn">reset</button>
    </div>
  </section>

  <!-- reset overlay -->
  <div id="resetOverlay" class="overlay hidden" aria-hidden="true">
    <div class="modal">
      <h3 id="resetTitle" style="margin:0 0 6px 0">RESET</h3>
      <pre id="resetBody" style="white-space:pre-wrap;opacity:.85;margin:0"></pre>
    </div>
  </div>

  <!-- final overlay -->
  <div id="finalOverlay" class="overlay hidden" aria-hidden="true">
    <div class="modal">
      <h3 style="margin:0 0 8px 0">Finalize</h3>
      <div style="opacity:.8;margin-bottom:10px">Enter your Discord and final answer, then verify.</div>

      <label style="display:block;margin-bottom:8px;opacity:.8">Discord</label>
      <input id="finalDiscord" placeholder="your discord username" />

      <label style="display:block;margin:12px 0 8px;opacity:.8">Answer</label>
      <input id="finalAnswer" placeholder="answer" />

      <div style="margin-top:12px" id="turnstileBox"></div>
      <div id="finalErr" style="margin-top:10px;color:rgba(255,190,190,.95)"></div>

      <div class="modal-actions">
        <button id="finalCancel" class="sim-btn">cancel</button>
        <button id="finalVerify" class="sim-btn">verify</button>
      </div>
    </div>
  </div>

  <script src="/dialogue.js"></script>
  <script src="/tasks.js"></script>

  <script src="/packs/pack1.js"></script>
  <script src="/packs/pack2.js"></script>
  <script src="/packs/pack3.js"></script>
  <script src="/packs/pack4.js"></script>
  <script src="/packs/pack5.js"></script>

  <script src="/audio_player.js"></script>
  <script src="/main.js"></script>

  <!-- landing-only tiny script -->
  <script>
    // Random side ads from your existing pool
    const IMAGE_POOL = Array.from({ length: 12 }, (_, i) => `/assets/img${i + 1}.jpg`);
    document.querySelectorAll(".adImg").forEach(img => {
      img.src = IMAGE_POOL[Math.floor(Math.random() * IMAGE_POOL.length)];
    });

    // Live timestamp (updates every second)
    const ts = document.getElementById("timestamp");
    const build = document.getElementById("build");
    const started = Date.now() - Math.floor(Math.random() * 900000);

    function tick(){
      const now = new Date();
      const t = now.toLocaleTimeString([], { hour:"2-digit", minute:"2-digit", second:"2-digit" });
      ts.textContent = `time: ${t}`;

      const delta = Date.now() - started;
      const s = Math.floor(delta/1000)%60;
      const m = Math.floor(delta/60000)%60;
      const h = Math.floor(delta/3600000);
      build.textContent = `uptime: ${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
    }
    tick();
    setInterval(tick, 1000);
  </script>

  <!-- ✅ Admin token logic (Option A: unlock hidden panel) -->
  <script>
    // matches your new chosen token
    const ADMIN_TOKEN = "echostatic07vault";

    const elToken = document.getElementById("viewerToken");
    const elEnter = document.getElementById("adminEnter");
    const elClear = document.getElementById("adminClear");
    const elMsg = document.getElementById("adminMsg");
    const hiddenPanel = document.getElementById("adminPanelHidden");

    function setAdmin(on){
      document.body.classList.toggle("admin", !!on);
      if (elMsg) elMsg.textContent = on
        ? "operator session flagged: internal."
        : "notice: this endpoint is not intended for external access.";
      try { localStorage.setItem("admin_ok", on ? "1" : "0"); } catch {}
    }

    // restore
    (function(){
      try {
        if (localStorage.getItem("admin_ok") === "1") setAdmin(true);
      } catch {}
    })();

    function deny(){
      setAdmin(false);
      if (elMsg) elMsg.textContent = "denied: invalid token.";
      document.body.classList.add("shake");
      setTimeout(() => document.body.classList.remove("shake"), 260);
      try { window.glitch?.(); } catch {}
    }

    function validate(){
      const v = (elToken?.value || "").trim();
      if (!v) return;
      if (v.toLowerCase() === ADMIN_TOKEN.toLowerCase()) setAdmin(true);
      else deny();
    }

    elEnter?.addEventListener("click", validate);
    elToken?.addEventListener("keydown", (e) => { if (e.key === "Enter") validate(); });
    elClear?.addEventListener("click", () => { if (elToken) elToken.value = ""; setAdmin(false); });
  </script>
</body>
</html>
